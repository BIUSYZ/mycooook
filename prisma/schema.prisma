// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  recipes     Recipe[]
  mealRecords MealRecord[]
  settings    UserSettings?
}

model Recipe {
  id          String   @id @default(uuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  name        String
  description String?
  category    String
  prepTime    Int
  cookTime    Int
  servings    Int
  difficulty  String
  mainImage   String?
  images      String   @default("[]") // JSON string for array
  isFavorite  Boolean  @default(false)
  notes       String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  ingredients RecipeIngredient[]
  steps       CookingStep[]
  tags        RecipeTag[]
  mealRecords MealRecord[]
}

model RecipeIngredient {
  id         String  @id @default(uuid())
  recipeId   String
  recipe     Recipe  @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  name       String
  amount     String
  unit       String?
  isOptional Boolean @default(false)
}

model IngredientOption {
  id        String   @id @default(uuid())
  name      String   @unique
  category  String?
  createdAt DateTime @default(now())
}

model CookingStep {
  id          String  @id @default(uuid())
  recipeId    String
  recipe      Recipe  @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  stepNumber  Int
  instruction String
  image       String?
}

model RecipeTag {
  id       String @id @default(uuid())
  recipeId String
  recipe   Recipe @relation(fields: [recipeId], references: [id], onDelete: Cascade)
  name     String
  color    String
}

model MealRecord {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  recipeId  String?
  recipe    Recipe?  @relation(fields: [recipeId], references: [id], onDelete: SetNull)
  date      String   // YYYY-MM-DD
  mealType  String
  notes     String?
  rating    Int?
  createdAt DateTime @default(now())
}

model UserSettings {
  userId      String @id
  user        User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  theme       String @default("light")
  preferences String @default("{}") // JSON string
}
